"use strict";var _=require("lodash"),React=require("react/addons"),Form=require("../../resource-editing/resource-form/Form"),FormStore=require("../../../stores/FormStore"),FormKeyMixin=require("../../../mixins/FormKeyMixin"),MultipleFilterOptions=React.createClass({displayName:"MultipleFilterOptions",mixins:[FormKeyMixin],propTypes:{options:React.PropTypes.object.isRequired,actionMethod:React.PropTypes.func},getInitialState:function(){return{formKey:"",formData:{}}},componentDidMount:function(){var e=this._generateFormKey();this.setState({formKey:e,formData:FormStore.getResource(e)}),FormStore.addChangeListener(this._onChange)},componentWillUnmount:function(){FormStore.removeChangeListener(this._onChange)},buildOptionGroups:function(){var e=[];for(var t in this.props.options)e.push(React.createElement("div",null,this.buildOptions(t)));return React.createElement(Form,{key:this.state.formKey,formKey:this.state.formKey,bindResource:this.state.formData},e)},buildOptions:function(e){var t=[];for(var r in this.props.options[e]){if(!this.props.options[e][r])return;t.push({label:r,value:this.props.options[e][r]})}return React.createElement(Form.Checkbox,{fieldKey:e,options:t,label:e,labelAttribute:"label",required:!1})},handleChange:function(e,t){var r={};t?r.filters=t:r.filters={},this.props.actionMethod(r)},_onChange:function(){var e=this;e.setState(function(t){return t.formData=FormStore.getResource(e.state.formKey),e.setFilters(),t})},setFilters:function(){var e=_.cloneDeep(this.state.formData),t={};for(var r in e)e[r].forEach(function(e){var r=Object.keys(e.value);e.value.hasOwnProperty(r)&&(void 0===t[r]?t[r]="["+e.value[r]:t[r]+=","+e.value[r])});for(var o in t)t[o]=t[o]+"]";this.handleChange(this.state.formKey,t)},render:function(){return React.createElement("div",{className:"multi-select form-group"},this.buildOptionGroups())}});module.exports=MultipleFilterOptions;