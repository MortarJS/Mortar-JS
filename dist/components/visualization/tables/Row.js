"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},_extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(t[s]=o[s])}return t},_=require("lodash"),React=require("react"),classNames=require("classnames"),Input=require("../../resource-editing/resource-form/Input"),Row=React.createClass({displayName:"Row",propTypes:{data:React.PropTypes.object.isRequired,dataKeys:React.PropTypes.object.isRequired,options:React.PropTypes.shape({actionableRows:React.PropTypes.bool,editableRows:React.PropTypes.oneOfType([React.PropTypes.bool,React.PropTypes.arrayOf(React.PropTypes.string)]),actions:React.PropTypes.array,draggable:React.PropTypes.bool,actionsCallback:React.PropTypes.func}),handleDragStart:React.PropTypes.func,handleDragEnd:React.PropTypes.func,handleDragOverRow:React.PropTypes.func},rowClasses:function(){return{"table-row":!0,"table-row-sortable":this.props.options.draggable}},getInitialState:function(){return{bindResource:{},showSave:!1}},doActionOnResource:function(t){"saveRow"===t||"cancelEditRow"===t?(this.props.options.actionsCallback(t,this.state.bindResource),this.hideSave()):this.props.options.actionsCallback(t,this.props.data)},buildActionOptions:function(){var t=[];return this.state.showSave&&t.push(React.createElement("div",{className:"editable-row-action-buttons"},React.createElement("button",{className:"btn btn-outline btn-success btn-xs action-button",onClick:this.doActionOnResource,"data-action":"saveRow"},"Save"),React.createElement("button",{className:"btn btn-outline btn-warning btn-xs action-button",onClick:this.cancelEdit,"data-action":"cancelEditRow"},"Cancel"))),t.push(this.props.options.actions.map(function(t,e){var o=t.split(":"),s=o[0],a=o[1]||"primary";if("deactivate"===s){var n=this._determineDeactivateStrings();s=n.action,a=n.buttonType}return React.createElement("button",{key:e,className:"btn btn-outline btn-"+a+" btn-xs action-button",onClick:this.doActionOnResource.bind(null,s),"data-action":s},s)}.bind(this))),React.createElement("td",{key:99},t)},_shouldHighlightRow:function(t){return"undefined"==typeof this.props.options.highlightRow?t:(t[this.props.options.highlightRow["class"]]=this.props.options.highlightRow.test(this.props.data),t)},_determineDeactivateStrings:function(){return"string"==typeof this.props.data.deleted_at?{action:"reactivate",buttonType:"success"}:{action:"deactivate",buttonType:"danger"}},componentDidMount:function(){this.setState({bindResource:this.props.data})},componentWillReceiveProps:function(t){this.setState({bindResource:t.data})},handleChange:function(t,e){var o=this.state.bindResource;o[t]=e,this.setState({bindResource:o})},hideSave:function(){this.setState({showSave:!1})},showSave:function(){this.setState({showSave:!0})},cancelEdit:function(t){this.doActionOnResource(t)},buildRowData:function(){var t=this.props.data,e=this.props.dataKeys,o=Object.keys(e).map(function(t,o){return e[t]});if(this.props.options.editableRows){if("boolean"==typeof this.props.options.editableRows)var t=o.map(function(e,o){var s=_.get(t,e);return React.createElement("td",{key:o},React.createElement(Input,_extends({fieldKey:e,type:"text",changeCallback:this.handleChange,onFocus:this.showSave,bindResource:this.state.bindResource,placeholder:"Click to Edit.."},this.mutateData(e,s,o))))}.bind(this));else if("object"===_typeof(this.props.options.editableRows))var t=o.map(function(e,o){var s=_.get(t,e);return _.contains(this.props.options.editableRows,e)?React.createElement("td",{key:o},React.createElement(Input,_extends({fieldKey:e,type:"text",changeCallback:this.handleChange,onFocus:this.showSave,bindResource:this.state.bindResource,placeholder:"Click to Edit.."},this.mutateData(e,s,o)))):React.createElement("td",{key:o},this.mutateData(e,s,o)||s)}.bind(this))}else var t=o.map(function(e,o){var s=_.get(t,e);return React.createElement("td",{key:o},this.mutateData(e,s,o)||s)}.bind(this));if(this.props.options&&this.props.options.actionableRows&&t.push(this.buildActionOptions()),this.props.options&&"object"===_typeof(this.props.options.mainAction)&&t.unshift(React.createElement("td",{key:99},this.props.options.mainAction.button)),this.props.options&&this.props.options.bulkActions){var s=this.state.bindResource.selected||!1;t.unshift(React.createElement("th",{key:101},React.createElement("input",{type:"checkbox",value:s,checked:s,onChange:this.selectRow})))}return t},selectRow:function(t){this.setState(function(t){return t.bindResource.selected=!t.bindResource.selected,this.props.options.actionsCallback("selectedRow",t.bindResource),t})},mutateData:function(t,e,o){var s=this.props.options.mutators||{},a=s[t];return a?a(e,this.state.bindResource,o):e},render:function(){var t=classNames(this._shouldHighlightRow(this.rowClasses()));return React.createElement("tr",{className:t,draggable:this.props.options.draggable,onDragStart:this.props.handleDragStart,onDragEnd:this.props.handleDragEnd,onDragOver:this.props.handleDragOverRow,"data-resource-index":this.props.index},this.buildRowData(),this.props.children)}});module.exports=Row;