"use strict";var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},_=require("lodash"),Row=require("./Row"),React=require("react/addons"),SumRow=require("./SumRow"),Rows=React.createClass({displayName:"Rows",propTypes:{data:React.PropTypes.array.isRequired,dataKeys:React.PropTypes.object.isRequired,options:React.PropTypes.shape({editableRows:React.PropTypes.bool,summableRows:React.PropTypes.array,draggable:React.PropTypes.bool,actionsCallback:React.PropTypes.func,mutators:React.PropTypes.object}),actionCreator:React.PropTypes.object},getInitialState:function(){return{sortOrder:[]}},getDefaultProps:function(){return{data:[],sortOrder:[]}},componentWillReceiveProps:function(e){this.setState({sortOrder:e.data.map(function(e){return e.id})})},_renderPlaceHolder:function(){if(!this.placeholder){var e=document.createElement("tr");e.className="placeholder";var t=document.createElement("td");t.colSpan=this.props.data.length,e.appendChild(t),this.placeholder=e}return this.placeholder},handleDragStart:function(e){this.dragged=e.currentTarget,this.dragged.style.opacity=.5,e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",e.currentTarget)},handleDragOverRow:function(e){if(e.preventDefault(),"placeholder"!==e.target.className){this.over=e.currentTarget;var t=e.pageY-this.over.offsetTop,r=e.pageY-this.over.parentNode.lastChild.offsetTop,a=e.currentTarget.parentNode;t==r?(this.nodePlacement="after",a.insertBefore(this._renderPlaceHolder(),e.currentTarget.nextElementSibling)):(this.nodePlacement="before",a.insertBefore(this._renderPlaceHolder(),e.currentTarget))}},handleDragEnd:function(e){this.dragged.style.opacity=1,this.dragged.parentNode.removeChild(this._renderPlaceHolder());var t=this.props.data,r=Number(this.dragged.dataset.resourceIndex),a=Number(this.over.dataset.resourceIndex);a>r&&a--,"after"===this.nodePlacement&&a++,t.splice(a,0,t.splice(r,1)[0]),this.setState({sortOrder:t},function(){this.props.options.actionsCallback("dragSort",this.state.sortOrder)})},render:function(){var e={handleDragStart:this.handleDragStart,handleDragEnd:this.handleDragEnd,handleDragOverRow:this.handleDragOverRow},t=this.props.dataKeys,r=this.props.options,a=this.props.data.map(function(a,o){return React.createElement(Row,_extends({key:o,index:o,data:a,dataKeys:t,options:r},e))}.bind(this));return this.props.options.summableRows&&a.push(React.createElement(SumRow,{key:"sumRow",data:this.props.data,dataKeys:this.props.dataKeys,options:this.props.options,rows:this.props.options.summableRows})),React.createElement("tbody",{className:"table-rows",ref:"tableBody"},a)}});module.exports=Rows;