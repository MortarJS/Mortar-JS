"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},React=require("react"),classNames=require("classnames"),FormUtility=require("./utils/FormUtilityMixin"),FileInput=React.createClass({displayName:"FileInput",propTypes:{options:React.PropTypes.shape({multiple:React.PropTypes.bool,height:React.PropTypes.number,width:React.PropTypes.number,srcProperty:React.PropTypes.string,b64encoded:React.PropTypes.bool,bgImage:React.PropTypes.string,hidePreview:React.PropTypes.bool}),onFileSelect:React.PropTypes.func,label:React.PropTypes.string,helpText:React.PropTypes.string,accept:React.PropTypes.string.isRequired,fieldKey:React.PropTypes.string,changeCallback:React.PropTypes.func},mixins:[FormUtility],getInitialState:function(){return{dragIsActive:!1,fileIsUploaded:!1,imageUrl:null,files:[],filePreviews:[],fieldValue:[]}},open:function(){this.refs.fileInput.click()},handleDragLeave:function(){this.setState({dragIsActive:!1})},handleDragOver:function(e){e.preventDefault(),e.dataTransfer.dropEffect="copy",this.setState({dragIsActive:!0})},componentDidMount:function(){this._componentDidMount()},componentWillUnmount:function(){this._componentWillUnmount()},handleFiles:function(e){e.preventDefault(),this.setState({dragIsActive:!1});var t=void 0;e.dataTransfer?t=e.dataTransfer.files:e.target&&(t=e.target.files);for(var i=this.props.options.multiple?t.length:1,s=0;s<i;s++)t[s].preview=URL.createObjectURL(t[s]);t=Array.prototype.slice.call(t,0,i);var a=[];if("undefined"!=typeof this.props.options&&this.props.options.b64encoded){var r=this,o=this._handleChange;t.forEach(function(e,i){var s=new FileReader;s.onloadend=function(s){var n=s.target.result;t[i]=btoa(n),a[i]=e.preview,r.setState({files:t.length>1?t:t[0],filePreviews:a},function(){o()})},s.readAsBinaryString(e)})}else if(this.props.options&&this.props.options.multiple){var n=this.state.fieldValue||[],l=[].concat(_toConsumableArray(n),_toConsumableArray(t)).filter(function(e){return!!e});this._handleChange(l)}else this._handleChange(t)},_handleChange:function(e){this.props.changeCallback(this.props.fieldKey,e,this)},_shouldRenderBackground:function(){if(this.state.files.length>0||this.state.files instanceof File){if(this.props.options&&this.props.options.hidePreview)return React.createElement("span",null,"File(s) selected.");if(this.state.filePreviews.length>0)return React.createElement("img",{src:this.state.filePreviews[0],height:this.props.options.height-5,width:this.props.options.width-5})}if(this.props.options&&"undefined"!=typeof this.props.options.bgImage){var e=this.props.options.b64encoded&&this.props.options.bgIsB64?"data:image/png;base64,"+this.props.options.bgImage:this.props.options.bgImage;return React.createElement("img",{src:e,height:this.props.options.height-5,width:this.props.options.width-5})}return React.createElement("span",null,"Drag and drop or browse for files to upload.")},_buildAcceptString:function(){var e={audio:"audio/*",video:"video/*",image:"image/*"};return e.hasOwnProperty(this.props.accept)?e[this.props.accept]:this.props.accept},removeUpload:function(e){var t=this.state.fieldValue.slice(0);t.splice(e,1),this._handleChange(t)},multipleFilePreview:function(){var e=this,t=!(!this.props.options||!this.props.options.hidePreview);if(this.state.fieldValue&&this.state.fieldValue.length&&!t){var i=function(){var t=e.state.fieldValue,i=e.props.options,s=i&&i.height?i.height:200,a=i&&i.width?i.width:200;return{v:React.createElement("div",{id:"mortar-file-upload-preview-container"},t.map(function(t,r){var o=void 0;return o=t.preview?t.preview:i.srcProperty?t[i.srcProperty]:t,React.createElement("div",{key:r,className:"mortar-file-upload-preview-wrapper"},React.createElement("a",{href:"javascript:void(0)",className:"mortar-file-upload remove-preview icon icon-times",onClick:e.removeUpload.bind(e,r)}),React.createElement("img",{className:"mortar-file-upload mortar-file-upload-preview",src:o,width:a,height:s,onError:function(){arguments[0].target.src="../../../../assets/document.svg"}}))}))}}();if("object"===("undefined"==typeof i?"undefined":_typeof(i)))return i.v}return null},render:function(){var e=classNames({"file-upload":!0,active:this.state.dragIsActive}),t={width:this.props.options.width||100,height:this.props.options.height||100,borderStyle:this.state.fileIsUploaded?"":this.state.dragIsActive?"solid":"dashed"};return this.props.options&&this.props.options.multiple?React.createElement("div",{className:"upload-file-container"},React.createElement("div",{className:e,onDragLeave:this.handleDragLeave,onDragOver:this.handleDragOver,onDrop:this.handleFiles},React.createElement("input",{className:"mortar-file-upload "+this.props.formKey+"-"+this.props.fieldKey,style:{display:"none"},name:this.props.fieldKey,type:"file",ref:"fileInput",onChange:this.handleFiles,multiple:this.props.options.multiple||!1,accept:this._buildAcceptString()}),React.createElement("label",{className:"control-label upload-label"},React.createElement("a",{onClick:this.open,href:"javascript:void(0)"},this.props.label))),"undefined"!=typeof this.props.helpText&&React.createElement("p",{className:"help=block upload-help-block"},this.props.helpText),this.multipleFilePreview()):React.createElement("div",{className:"upload-file-container"},React.createElement("div",{className:e,style:t,onClick:this.open,onDragLeave:this.handleDragLeave,onDragOver:this.handleDragOver,onDrop:this.handleFiles},React.createElement("div",{className:"upload-overlay"},this._shouldRenderBackground()),React.createElement("input",{className:"mortar-file-upload "+this.props.formKey+"-"+this.props.fieldKey,style:{display:"none"},name:this.props.fieldKey,type:"file",ref:"fileInput",onChange:this.handleFiles,multiple:this.props.options.multiple||!1,accept:this._buildAcceptString()})),React.createElement("label",{className:"control-label upload-label"},this.props.label),"undefined"!=typeof this.props.helpText&&React.createElement("p",{className:"help=block upload-help-block"},this.props.helpText))}});module.exports=FileInput;