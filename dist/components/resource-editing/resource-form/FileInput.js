"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},React=require("react/addons"),classNames=require("classnames"),FormUtility=require("./FormUtilityMixin"),FileInput=React.createClass({displayName:"FileInput",propTypes:{options:React.PropTypes.shape({multiple:React.PropTypes.bool,height:React.PropTypes.number,width:React.PropTypes.number,b64encoded:React.PropTypes["boolean"],bgImage:React.PropTypes.String}),onFileSelect:React.PropTypes.func,label:React.PropTypes.string,helpText:React.PropTypes.string,accept:React.PropTypes.string.isRequired},mixins:[FormUtility],getInitialState:function(){return{dragIsActive:!1,fileIsUploaded:!1,imageUrl:null,files:[],filePreviews:[]}},open:function(){this.refs.fileInput.getDOMNode().click()},handleClick:function(){this.open()},handleDragLeave:function(e){this.setState({dragIsActive:!1})},handleDragOver:function(e){e.preventDefault(),e.dataTransfer.dropEffect="copy",this.setState({dragIsActive:!0})},componentWillReceiveProps:function(e){_typeof(this._findValueByPath(e.bindResource,e.fieldKey))&&this.setState(this.getInitialState())},handleDrop:function(e){e.preventDefault(),this.setState({dragIsActive:!1});var t;e.dataTransfer?t=e.dataTransfer.files:e.target&&(t=e.target.files);for(var i=this.props.options.multiple?t.length:1,s=0;i>s;s++)t[s].preview=URL.createObjectURL(t[s]);t=Array.prototype.slice.call(t,0,i);var a=[];if("undefined"!=typeof this.props.options&&this.props.options.b64encoded){var o=this,r=this._handleChange;t=t.map(function(e,i){var s=new FileReader;s.onloadend=function(s){var n=s.target.result;t[i]=btoa(n),a[i]=e.preview,o.setState({files:t.length>1?t:t[0],filePreviews:a},function(){r()})},s.readAsBinaryString(e)})}else this.setState({files:t.length>1?t:t[0],filePreviews:a},function(){this._handleChange()})},_handleChange:function(){this.props.changeCallback(this.props.fieldKey,this.state.files,this)},_shouldRenderBackground:function(){if(this.state.files.length>0||this.state.files instanceof File){if(this.props.options&&this.props.options.hidePreview)return React.createElement("span",null,"File(s) selected.");if(this.state.filePreviews.length>0)return React.createElement("img",{src:this.state.filePreviews[0],height:this.props.options.height-5,width:this.props.options.width-5})}if(this.props.options&&"undefined"!=typeof this.props.options.bgImage){var e=this.props.options.b64encoded&&this.props.options.bgIsB64?"data:image/png;base64,"+this.props.options.bgImage:this.props.options.bgImage;return React.createElement("img",{src:e,height:this.props.options.height-5,width:this.props.options.width-5})}return React.createElement("span",null,"Drag and drop or browse for files to upload.")},_buildAcceptString:function(){var e={audio:"audio/*",video:"video/*",image:"image/*"};return e.hasOwnProperty(this.props.accept)?e[this.props.accept]:this.props.accept},render:function(){var e=classNames({"file-upload":!0,active:this.state.dragIsActive}),t={width:this.props.options.width||100,height:this.props.options.height||100,borderStyle:this.state.fileIsUploaded?"":this.state.dragIsActive?"solid":"dashed"};return React.createElement("div",{className:"upload-file-container"},React.createElement("div",{className:e,style:t,onClick:this.handleClick,onDragLeave:this.handleDragLeave,onDragOver:this.handleDragOver,onDrop:this.handleDrop},React.createElement("div",{className:"upload-overlay"},this._shouldRenderBackground()),React.createElement("input",{style:{display:"none"},name:this.props.fieldKey,type:"file",ref:"fileInput",onChange:this.handleDrop,mutiple:this.props.options.multiple,accept:this._buildAcceptString()})),React.createElement("label",{className:"control-label upload-label"},this.props.label),"undefined"!=typeof this.props.helpText&&React.createElement("p",{className:"help=block upload-help-block"},this.props.helpText))}});module.exports=FileInput;