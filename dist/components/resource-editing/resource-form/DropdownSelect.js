"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},_=require("lodash"),React=require("react/addons"),isEmpty=require("../../../utils/isEmpty"),className=require("classnames"),Input=require("./Input"),Button=require("../../Global/button/Button"),AppActionConstants=require("../../../constants/AppActionConstants"),FormStore=require("../../../stores/FormStore"),FormUtility=require("./FormUtilityMixin"),DropdownSelect=React.createClass({displayName:"DropdownSelect",propTypes:{fieldKey:React.PropTypes.string.isRequired,placeholder:React.PropTypes.string,callback:React.PropTypes.func,changeCallback:React.PropTypes.func,options:React.PropTypes.array.isRequired,unique:React.PropTypes.string,label:React.PropTypes.oneOfType([React.PropTypes.string,React.PropTypes.func]),inputLabel:React.PropTypes.string,multiple:React.PropTypes.bool,disabled:React.PropTypes.bool,debug:React.PropTypes.bool},mixins:[FormUtility],getInitialState:function(){return this.props.debug&&(console.log("DropdownSelect Debug Information:"),console.log("OPTIONS:"),console.table(this.props.options),console.log("LABEL:",this.props.label)),{isValid:!0,expandDropdown:!1,fieldValue:[]}},componentDidMount:function(){window.__app_container.addEventListener("click",this.handleClick)},componentWillUnmount:function(){window.__app_container.removeEventListener("click",this.handleClick)},componentWillReceiveProps:function(e){this.setState({fieldValue:this._findValueByPath(e.bindResource,e.fieldKey)})},setSelected:function(e){this.props.unique||this.props.label||"label";if(this.props.multiple){var t=this.state.fieldValue||[];t.push(e),t="object"===("undefined"==typeof e?"undefined":_typeof(e))?_.uniq(t,this.props.label||"label"):_.uniq(t),this.props.changeCallback(this.props.fieldKey,t,this),this.props.callback&&this.props.callback()}else this.setState({expandDropdown:!1}),this.props.changeCallback(this.props.fieldKey,e,this),this.props.callback&&this.props.callback()},removeOption:function(e){var t=this.state.fieldValue;this.props.multiple?t.splice(e,1):t=-1===e?"":{},this.props.changeCallback(this.props.fieldKey,t,this),this.props.callback&&this.props.callback()},handleClick:function(e){var t=this.refs.dropdown.getDOMNode();this.state.expandDropdown&&!t.contains(e.target)&&this.toggleDropdown()},toggleDropdown:function(){isEmpty(this.props.options)||this.setState({expandDropdown:!this.state.expandDropdown})},handleAction:function(e,t,o){switch(e){case"select":this.setSelected(t);break;case"remove":o.stopPropagation(),this.removeOption(t)}},displaySelected:function(){if(isEmpty(this.state.fieldValue))return React.createElement("div",null,this.props.placeholder||"Make a selection");var e=this.props.label||"label";if(this.state.fieldValue[0])var t=this.state.fieldValue;else var t=[this.state.fieldValue];return"object"===("undefined"==typeof t?"undefined":_typeof(t))?t.map(function(t,o){if("object"===("undefined"==typeof t?"undefined":_typeof(t))){if("function"==typeof e)var s=e(t,o);else var s=t[e];return React.createElement("div",{className:"selected-option"},s,React.createElement("a",{href:"javascript:void(0)",className:"icon-times",onClick:this.handleAction.bind(null,"remove",o)}))}return React.createElement("div",{className:"selected-option"},t,React.createElement("a",{href:"javascript:void(0)",className:"icon-times",onClick:this.handleAction.bind(null,"remove",o)}))}.bind(this)):React.createElement("div",{className:"selected-option"},t,React.createElement("a",{href:"javascript:void(0)",className:"icon-times",onClick:this.handleAction.bind(null,"remove",-1)}))},buildSelectOptions:function(){var e=this.props.options||[],t=this.props.label||"label";return e.map(function(e,o){var s;return s="object"===("undefined"==typeof e?"undefined":_typeof(e))?"function"==typeof t?t(e,o):e[t]:e,React.createElement("li",{onClick:this.handleAction.bind(null,"select",e),className:"dropdown-option list-group-item"}," ",s," ")}.bind(this))},headerClasses:function(){return{"pull-right":!0,"icon-chevron-down":!0}},dropdownContainerClasses:function(){return{"dropdown-container":!0,panel:!0,open:this.state.expandDropdown,closed:!this.state.expandDropdown,disabled:this.props.disabled||!this.props.options.length}},dropdownClasses:function(){return{"dropdown-drawer":!0,visible:this.state.expandDropdown,hidden:!this.state.expandDropdown,fill:!0}},render:function(){var e=this.state,t=this.props.options,o=function(){switch(e.expandDropdown){case!0:return{maxHeight:45*t.length};case!1:return{maxHeight:0}}};return React.createElement("div",{ref:"dropdown"},this.props.inputLabel&&React.createElement("label",{className:"control-label"},this.props.inputLabel),React.createElement("div",{className:className(this.dropdownContainerClasses())},React.createElement("div",{className:"panel-heading",onClick:this.toggleDropdown},React.createElement("span",{className:className(this.headerClasses())}),this.displaySelected()),React.createElement("ul",{className:className(this.dropdownClasses()),style:o()},this.buildSelectOptions())))}});module.exports=DropdownSelect;