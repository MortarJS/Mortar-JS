"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},_=require("lodash"),React=require("react"),isEmpty=require("../../../utils/isEmpty"),className=require("classnames"),FormUtility=require("./utils/FormUtilityMixin"),DropdownSelect=React.createClass({displayName:"DropdownSelect",propTypes:{fieldKey:React.PropTypes.string.isRequired,placeholder:React.PropTypes.string,callback:React.PropTypes.func,changeCallback:React.PropTypes.func,options:React.PropTypes.array.isRequired,unique:React.PropTypes.string,label:React.PropTypes.oneOfType([React.PropTypes.string,React.PropTypes.func]),inputLabel:React.PropTypes.string,multiple:React.PropTypes.bool,disabled:React.PropTypes.bool,debug:React.PropTypes.bool},mixins:[FormUtility],getInitialState:function(){return this.props.debug&&(console.log("DropdownSelect Debug Information:"),console.log("OPTIONS:"),console.table(this.props.options),console.log("LABEL:",this.props.label)),{isValid:!0,expandDropdown:!1}},componentDidMount:function(){window.addEventListener("click",this.handleClick)},componentWillUnmount:function(){window.removeEventListener("click",this.handleClick)},setSelected:function(e){if(this.props.multiple){var t=this._fieldValue()||[];t.push(e),t="object"===("undefined"==typeof e?"undefined":_typeof(e))?_.uniq(t,this.props.label||"label"):_.uniq(t),this.props.changeCallback(this.props.fieldKey,t,this),this.props.callback&&this.props.callback()}else this.setState({expandDropdown:!1}),this.props.changeCallback(this.props.fieldKey,e,this),this.props.callback&&this.props.callback()},removeOption:function(e){var t=this._fieldValue();this.props.multiple?t.splice(e,1):t=e===-1?"":{},this.props.changeCallback(this.props.fieldKey,t,this),this.props.callback&&this.props.callback()},handleClick:function(e){var t=this.refs.dropdown;this.state.expandDropdown&&!t.contains(e.target)&&this.toggleDropdown()},toggleDropdown:function(){isEmpty(this.props.options)||this.props.disabled||this.setState({expandDropdown:!this.state.expandDropdown})},handleAction:function(e,t,o){switch(e){case"select":this.setSelected(t);break;case"remove":o.stopPropagation(),this.removeOption(t)}},displaySelected:function(){var e=this._fieldValue();if(isEmpty(e))return React.createElement("div",null,this.props.placeholder||"Make a selection");var t,o,s=this.props.label||"label",n=this.props.disabled||!this.props.options.length,a=this;return t=e[0]?e:[e],"object"===("undefined"==typeof t?"undefined":_typeof(t))?t.map(function(e,t){return"object"===("undefined"==typeof e?"undefined":_typeof(e))?(o="function"==typeof s?s(e,t):e[s],React.createElement("div",{className:"selected-option",key:"selected-"+t},React.createElement("span",{className:"mortar-dropdown-selected-value"},o),!n&&React.createElement("a",{href:"javascript:void(0)",className:"icon-times",onClick:a.handleAction.bind(null,"remove",t)}))):React.createElement("div",{className:"selected-option",key:"selected-"+t},React.createElement("span",{className:"mortar-dropdown-selected-value"},e),!n&&React.createElement("a",{href:"javascript:void(0)",className:"icon-times",onClick:a.handleAction.bind(null,"remove",t)}))}):React.createElement("div",{className:"selected-option",key:"selected-0"},React.createElement("span",{className:"mortar-dropdown-selected-value"},t),!n&&React.createElement("a",{href:"javascript:void(0)",className:"icon-times",onClick:this.handleAction.bind(null,"remove",-1)}))},buildSelectOptions:function(){var e=this.props.options||[],t=this.props.label||"label",o=this;return e.map(function(e,s){var n;return n="object"===("undefined"==typeof e?"undefined":_typeof(e))?"function"==typeof t?t(e,s):e[t]:e,React.createElement("li",{key:"option-"+s,onClick:o.handleAction.bind(null,"select",e),className:"dropdown-option list-group-item"},n)})},headerClasses:function(){return{"pull-right":!0,"icon-chevron-down":!0}},dropdownContainerClasses:function(){var e={"mortar-dropdown-container":!0,panel:!0,open:this.state.expandDropdown,closed:!this.state.expandDropdown,disabled:this.props.disabled||!this.props.options.length};return e[this.props.formKey+"-"+this.props.fieldKey]=!0,e},dropdownClasses:function(){return{"dropdown-drawer":!0,visible:this.state.expandDropdown,hidden:!this.state.expandDropdown,fill:!0}},render:function(){var e=this.state,t=this,o=function(){var o,s;if(t.refs.dropdownDrawer){o=t.refs.dropdownDrawer,s=0;for(var n=0;n<o.childNodes.length;n++)s+=o.childNodes[n].offsetHeight}switch(e.expandDropdown){case!0:return{maxHeight:s};case!1:return{maxHeight:0}}return!1};return React.createElement("div",{ref:"dropdown"},this.props.inputLabel&&React.createElement("label",{className:"control-label"},this.props.inputLabel),React.createElement("div",{className:className(this.dropdownContainerClasses())},React.createElement("div",{className:"panel-heading",onClick:this.toggleDropdown},React.createElement("span",{className:className(this.headerClasses())}),this.displaySelected()),React.createElement("ul",{className:className(this.dropdownClasses()),style:o(),ref:"dropdownDrawer"},this.buildSelectOptions())))}});module.exports=DropdownSelect;